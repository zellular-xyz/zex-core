syntax = "proto3";

message ZexState {
    map<string, Market> markets = 1;
    map<string, Balance> balances = 2;
    repeated AmountEntry amounts = 3;
    repeated TradeEntry trades = 4;
    repeated OrderEntry orders = 5;
    map<string, Withdrawals> withdrawals = 6;
    map<string, uint64> deposited_blocks = 7;
    repeated NonceEntry nonces = 8;
    repeated PairLookupEntry pair_lookup = 9;
    uint64 last_tx_index = 10;
}

message Market {
    string base_token = 1;
    string quote_token = 2;
    repeated Order buy_orders = 3;
    repeated Order sell_orders = 4;
    repeated OrderBookEntry bids_order_book = 5;
    repeated OrderBookEntry asks_order_book = 6;
    uint64 first_id = 7;
    uint64 final_id = 8;
    uint64 last_update_id = 9;
    bytes kline = 10; // Serialized pandas DataFrame
}

message Order {
    double price = 1;
    int64 index = 2;
    bytes tx = 3;
}

message OrderBookEntry {
    double price = 1;
    double amount = 2;
}

message Balance {
    repeated BalanceEntry balances = 1;
}

message BalanceEntry {
    bytes public_key = 1;
    double amount = 2;
}

message AmountEntry {
    bytes tx = 1;
    double amount = 2;
}

message TradeEntry {
    bytes public_key = 1;
    repeated Trade trades = 2;
}

message Trade {
    uint32 t = 1;
    double amount = 2;
    string pair = 3;
    uint32 order_type = 4;
    bytes order = 5;
}

message OrderEntry {
    bytes public_key = 1;
    repeated bytes orders = 2;
}

message Withdrawals {
    repeated WithdrawalEntry withdrawals = 1;
}

message WithdrawalEntry {
    bytes public_key = 1;
    repeated WithdrawTransaction transactions = 2;
}

message WithdrawTransaction {
    string token = 1;
    double amount = 2;
    uint32 nonce = 3;
    bytes public = 4;
    string chain = 5;
}

message NonceEntry {
    bytes public_key = 1;
    uint32 nonce = 2;
}

message PairLookupEntry {
    bytes key = 1;
    string base_token = 2;
    string quote_token = 3;
    string pair = 4;
}